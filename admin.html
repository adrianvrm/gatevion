<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Gatevion ‚Äì Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CDN doar pentru prototip / admin static -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.7);
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(100, 116, 139, 0.9);
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-100 via-slate-50 to-slate-100 text-slate-900">
  <div class="min-h-screen flex flex-col">
    <!-- Top nav simplu -->
    <header class="w-full border-b border-slate-200 bg-white/80 backdrop-blur">
      <div class="max-w-7xl mx-auto flex items-center justify-between px-4 lg:px-8 py-3">
        <div class="flex items-center gap-2">
          <div class="h-8 w-8 rounded-xl bg-slate-900 flex items-center justify-center text-xs font-semibold text-white shadow-sm">
            GV
          </div>
          <div>
            <div class="text-sm font-semibold text-slate-900">Gatevion Admin</div>
            <div class="text-[0.7rem] text-slate-500">Panou de administrare</div>
          </div>
        </div>
        <div class="flex items-center gap-3 text-[0.75rem]">
          <span class="hidden sm:inline-flex items-center gap-1 px-2 py-1 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-100">
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
            <span>logat ca admin (demo)</span>
          </span>
        </div>
      </div>
      <!-- Tabs -->
      <div class="border-t border-slate-200 bg-slate-50/80">
        <div class="max-w-7xl mx-auto px-4 lg:px-8 flex gap-4 text-sm">
          <button class="px-3 py-2 text-slate-400 hover:text-slate-600 transition-colors cursor-default" disabled>Overview</button>
          <button class="px-3 py-2 border-b-2 border-slate-900 text-slate-900 font-medium">RezervƒÉri</button>
          <button class="px-3 py-2 text-slate-400 hover:text-slate-600 transition-colors cursor-default" disabled>Parteneri</button>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="max-w-7xl mx-auto py-8 px-4 lg:px-8 space-y-6">
        <!-- Header RezervƒÉri -->
        <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
          <div>
            <h1 class="text-3xl font-semibold tracking-tight text-slate-900">RezervƒÉri</h1>
            <p class="text-sm text-slate-500 mt-1">
              Vizualizezi »ôi gestionezi rezervƒÉrile, detaliile clien»õilor »ôi alocƒÉrile cƒÉtre parteneri.
            </p>
          </div>
          <div class="inline-flex items-center gap-2 bg-white/80 backdrop-blur rounded-full border border-slate-200 px-4 py-2 shadow-sm">
            <span class="inline-flex h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
            <span class="text-xs font-medium text-slate-600">Interfa»õƒÉ demo ‚Äì date mock</span>
          </div>
        </header>

        <!-- Carduri statistici -->
        <section class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div class="bg-white/90 backdrop-blur rounded-2xl border border-slate-200 shadow-sm p-4 flex flex-col gap-1">
            <div class="text-[0.65rem] font-semibold text-slate-500 uppercase tracking-wide">Total rezervƒÉri</div>
            <div id="statTotal" class="text-2xl font-semibold text-slate-900">0</div>
            <div class="text-[0.7rem] text-slate-400">Toate √ÆnregistrƒÉrile din sistem</div>
          </div>
          <div class="bg-white/90 backdrop-blur rounded-2xl border border-slate-200 shadow-sm p-4 flex flex-col gap-1">
            <div class="text-[0.65rem] font-semibold text-slate-500 uppercase tracking-wide">√én a»ôteptare</div>
            <div id="statPending" class="text-2xl font-semibold text-amber-600">0</div>
            <div class="text-[0.7rem] text-slate-400">Nu au fost confirmate √ÆncƒÉ</div>
          </div>
          <div class="bg-white/90 backdrop-blur rounded-2xl border border-slate-200 shadow-sm p-4 flex flex-col gap-1">
            <div class="text-[0.65rem] font-semibold text-slate-500 uppercase tracking-wide">Confirmate</div>
            <div id="statConfirmed" class="text-2xl font-semibold text-emerald-600">0</div>
            <div class="text-[0.7rem] text-slate-400">RezervƒÉri active, pregƒÉtite</div>
          </div>
          <div class="bg-white/90 backdrop-blur rounded-2xl border border-slate-200 shadow-sm p-4 flex flex-col gap-1">
            <div class="text-[0.65rem] font-semibold text-slate-500 uppercase tracking-wide">Anulate</div>
            <div id="statCancelled" class="text-2xl font-semibold text-rose-600">0</div>
            <div class="text-[0.7rem] text-slate-400">RezervƒÉri anulate sau expirate</div>
          </div>
        </section>

        <!-- Sec»õiune RezervƒÉri -->
        <section class="bg-white/90 backdrop-blur rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
          <div class="px-4 py-3 border-b border-slate-100 flex flex-col md:flex-row md:items-center md:justify-between gap-3 bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900">
            <div>
              <h2 class="text-base font-semibold text-white flex items-center gap-2">
                <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-white/10">
                  <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
                </span>
                RezervƒÉri active
              </h2>
              <p class="text-[0.7rem] text-slate-300 mt-0.5">
                ListƒÉ cu rezervƒÉrile recente »ôi acces rapid la detalii.
              </p>
            </div>
            <div class="flex flex-wrap items-center gap-2 text-[0.7rem] text-slate-200">
              <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white/10">
                <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span> confirmatƒÉ
              </span>
              <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white/10">
                <span class="w-1.5 h-1.5 rounded-full bg-amber-400"></span> √Æn a»ôteptare
              </span>
              <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white/10">
                <span class="w-1.5 h-1.5 rounded-full bg-rose-400"></span> anulatƒÉ
              </span>
            </div>
          </div>

          <!-- Toolbar search + sort + search field selector -->
          <div class="px-4 py-3 border-b border-slate-100 bg-slate-50/80 flex flex-col xl:flex-row gap-3 xl:items-center xl:justify-between">
            <div class="flex-1 flex flex-col md:flex-row md:items-center gap-2">
              <div class="flex items-center gap-2 w-full md:w-auto">
                <span class="text-[0.7rem] text-slate-500 whitespace-nowrap">CautƒÉ dupƒÉ</span>
                <select
                  id="searchField"
                  class="border border-slate-200 bg-white rounded-full px-2 py-1 text-xs text-slate-700 focus:outline-none focus:ring-1 focus:ring-sky-500"
                >
                  <option value="all">Toate c√¢mpurile</option>
                  <option value="id">ID</option>
                  <option value="customer_name">Nume client</option>
                  <option value="car_name">Ma»ôinƒÉ</option>
                  <option value="customer_email">Email</option>
                  <option value="customer_phone">Telefon</option>
                  <option value="created_at">Data solicitƒÉrii</option>
                  <option value="pickup_at">Data preluƒÉrii</option>
                  <option value="dropoff_at">Data returnƒÉrii</option>
                  <option value="status">Status</option>
                </select>
              </div>
              <div class="relative flex-1 max-w-xl">
                <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-slate-400 text-xs">üîç</span>
                <input
                  id="searchInput"
                  type="text"
                  class="w-full pl-8 pr-3 py-1.5 rounded-full border border-slate-200 bg-white text-xs text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
                  placeholder="Introdu valoarea cƒÉutatƒÉ..."
                />
              </div>
            </div>
            <div class="flex flex-wrap items-center gap-2 text-[0.7rem]">
              <div class="flex items-center gap-1">
                <span class="text-slate-500">SorteazƒÉ dupƒÉ</span>
                <select
                  id="sortField"
                  class="border border-slate-200 bg-white rounded-full px-2 py-1 text-xs text-slate-700 focus:outline-none focus:ring-1 focus:ring-sky-500"
                >
                  <option value="created_at">Data solicitƒÉrii</option>
                  <option value="pickup_at">Data preluƒÉrii</option>
                  <option value="dropoff_at">Data returnƒÉrii</option>
                  <option value="customer_name">Nume client</option>
                  <option value="car_name">Ma»ôinƒÉ</option>
                  <option value="status">Status</option>
                  <option value="id">ID</option>
                </select>
              </div>
              <div class="flex items-center gap-1">
                <span class="text-slate-500">Ordine</span>
                <select
                  id="sortDir"
                  class="border border-slate-200 bg-white rounded-full px-2 py-1 text-xs text-slate-700 focus:outline-none focus:ring-1 focus:ring-sky-500"
                >
                  <option value="desc">DescrescƒÉtor</option>
                  <option value="asc">CrescƒÉtor</option>
                </select>
              </div>
            </div>
          </div>

          <div class="p-3 overflow-auto">
            <table class="min-w-full text-sm">
              <thead class="text-left text-slate-500 border-b border-slate-100 bg-slate-50/80">
                <tr>
                  <th class="py-2 pr-4 font-medium text-[0.7rem] uppercase tracking-wide">ID</th>
                  <th class="py-2 pr-4 font-medium text-[0.7rem] uppercase tracking-wide">Client</th>
                  <th class="py-2 pr-4 font-medium text-[0.7rem] uppercase tracking-wide">Ma»ôinƒÉ</th>
                  <th class="py-2 pr-4 font-medium text-[0.7rem] uppercase tracking-wide">Preluare</th>
                  <th class="py-2 pr-4 font-medium text-[0.7rem] uppercase tracking-wide">Returnare</th>
                  <th class="py-2 pr-4 font-medium text-[0.7rem] uppercase tracking-wide">Total</th>
                  <th class="py-2 pr-4 font-medium text-[0.7rem] uppercase tracking-wide">Status</th>
                  <th class="py-2 pr-4 font-medium text-[0.7rem] uppercase tracking-wide">Detalii</th>
                </tr>
              </thead>
              <tbody id="resRows" class="divide-y divide-slate-100"></tbody>
            </table>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Modal detalii rezervare -->
  <div id="reservationModal" class="fixed inset-0 bg-black/45 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-slate-950 text-slate-50 rounded-2xl shadow-2xl shadow-slate-900/40 max-w-5xl w-full mx-4 max-h-[90vh] overflow-auto border border-slate-800">
      <div class="px-4 py-3 border-b border-slate-800 flex items-center justify-between bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 sticky top-0 z-10">
        <div class="flex items-center gap-3">
          <div class="h-8 w-8 rounded-xl bg-slate-800 flex items-center justify-center shadow-inner shadow-slate-900/60">
            <span class="text-xs font-semibold text-slate-200">RZV</span>
          </div>
          <div>
            <h2 class="text-sm font-semibold tracking-wide text-slate-50">Detalii rezervare</h2>
            <p class="text-[0.7rem] text-slate-400">Vizualizezi toate detaliile clientului »ôi ale rezervƒÉrii.</p>
          </div>
        </div>
        <button id="reservationModalClose" class="text-slate-400 hover:text-slate-100 text-xl leading-none px-2 py-1 rounded-full hover:bg-slate-800">
          &times;
        </button>
      </div>
      <div id="reservationModalBody" class="p-5 space-y-4 text-sm">
        <div class="text-center text-slate-400">Se √ÆncarcƒÉ...</div>
      </div>
    </div>
  </div>

  <script>
    // ======= DATE MOCK (p√¢nƒÉ le legƒÉm de backend) =======
    var allReservations = [
      {
        id: 101,
        customer_name: "Popescu Ion",
        customer_email: "ion.popescu@example.com",
        customer_phone: "+40 712 345 678",
        flight_number: "RO1234",
        car_name: "Dacia Logan 1.0",
        pickup_at: "2025-11-10T10:30:00Z",
        dropoff_at: "2025-11-15T18:00:00Z",
        created_at: "2025-11-01T09:15:00Z",
        pickup_code: "OTP",
        pickup_name: "Henri CoandƒÉ",
        dropoff_code: "OTP",
        dropoff_name: "Henri CoandƒÉ",
        status: "pending",
        total_price: 250,
        license_series: "B",
        license_number: "123456",
        id_series: "RX",
        id_number: "987654",
        birth_date: "1988-05-20",
        cnp: "1880520123456",
        address: "Str. Exemplu nr. 10, Bucure»ôti",
        travel_country: "Italia",
        notes: "Clientul a men»õionat cƒÉ are bagaje voluminoase.",
        partner_id: null
      },
      {
        id: 102,
        customer_name: "Ionescu Maria",
        customer_email: "maria.ionescu@example.com",
        customer_phone: "+40 723 111 222",
        flight_number: "FR5678",
        car_name: "VW Golf 1.5 TSI",
        pickup_at: "2025-12-01T09:00:00Z",
        dropoff_at: "2025-12-07T20:00:00Z",
        created_at: "2025-10-28T14:22:00Z",
        pickup_code: "OTP",
        pickup_name: "Henri CoandƒÉ",
        dropoff_code: "CLJ",
        dropoff_name: "Cluj-Napoca",
        status: "confirmed",
        total_price: 480,
        license_series: "B",
        license_number: "445566",
        id_series: "KX",
        id_number: "223344",
        birth_date: "1990-09-12",
        cnp: "2900912123456",
        address: "Bd. Eroilor nr. 5, Cluj-Napoca",
        travel_country: "Spania",
        notes: "Client fidel, preferƒÉ predare rapidƒÉ la sosire.",
        partner_id: 1
      },
      {
        id: 103,
        customer_name: "Vasile Andrei",
        customer_email: "andrei.vasile@example.com",
        customer_phone: "+40 744 999 000",
        flight_number: "WZ9999",
        car_name: "Renault Megane",
        pickup_at: "2025-10-01T13:00:00Z",
        dropoff_at: "2025-10-03T08:00:00Z",
        created_at: "2025-09-20T18:40:00Z",
        pickup_code: "CLJ",
        pickup_name: "Cluj-Napoca",
        dropoff_code: "CLJ",
        dropoff_name: "Cluj-Napoca",
        status: "cancelled",
        total_price: 120,
        license_series: "B",
        license_number: "777888",
        id_series: "AB",
        id_number: "111222",
        birth_date: "1985-02-02",
        cnp: "1850202123456",
        address: "Str. LibertƒÉ»õii nr. 3, Oradea",
        travel_country: "Germania",
        notes: "Rezervarea a fost anulatƒÉ de client.",
        partner_id: 2
      }
    ];

    var demoDocsByReservation = {
      101: [
        { doc_type: "CI fa»õƒÉ", file_name: "ci_fata_101.jpg", file_path: "ci_fata_101.jpg" },
        { doc_type: "CI verso", file_name: "ci_verso_101.jpg", file_path: "ci_verso_101.jpg" },
        { doc_type: "Permis", file_name: "permis_101.jpg", file_path: "permis_101.jpg" }
      ],
      102: [
        { doc_type: "CI fa»õƒÉ", file_name: "ci_fata_102.jpg", file_path: "ci_fata_102.jpg" }
      ],
      103: []
    };

    var demoPartners = [
      { id: 1, name: "Partener Bucure»ôti" },
      { id: 2, name: "Partener Cluj" }
    ];

    var currentReservations = allReservations.slice();

    // ======= UI HELPERS =======

    function formatDateTime(iso) {
      if (!iso) return "-";
      try {
        return new Date(iso).toLocaleString();
      } catch (e) {
        return iso;
      }
    }

    function formatDateOnly(iso) {
      if (!iso) return "-";
      try {
        var d = new Date(iso);
        return d.toLocaleDateString();
      } catch (e) {
        return iso;
      }
    }

    function statusBadgeClass(status) {
      if (status === "confirmed") return "bg-emerald-500/15 text-emerald-200 ring-1 ring-emerald-500/40";
      if (status === "pending") return "bg-amber-500/15 text-amber-200 ring-1 ring-amber-500/40";
      if (status === "cancelled") return "bg-rose-500/15 text-rose-200 ring-1 ring-rose-500/40";
      return "bg-slate-500/20 text-slate-200 ring-1 ring-slate-500/40";
    }

    function listStatusBadgeClass(status) {
      if (status === "confirmed") return "bg-emerald-100 text-emerald-800";
      if (status === "pending") return "bg-amber-100 text-amber-800";
      if (status === "cancelled") return "bg-rose-100 text-rose-800";
      return "bg-slate-200 text-slate-700";
    }

    function sectionLabel(text) {
      return '<div class="text-[0.65rem] font-semibold text-slate-400 uppercase tracking-[0.14em]">' + text + "</div>";
    }

    function fieldRow(label, value) {
      return (
        '<div class="space-y-1">' +
          sectionLabel(label) +
          '<div class="text-sm text-slate-50">' + (value || "-") + "</div>" +
        "</div>"
      );
    }

    function normalizePhone(str) {
      // scoate spa»õii, plus, paranteze, liniu»õe etc. -> rƒÉm√¢n doar cifrele
      return (str || "").replace(/[^0-9]/g, "");
    }

    // ======= FILTRARE + SORTARE =======
    function applyFiltersAndSort() {
      var searchInput = document.getElementById("searchInput");
      var searchField = document.getElementById("searchField");
      var sortField = document.getElementById("sortField");
      var sortDir = document.getElementById("sortDir");

      var term = (searchInput && searchInput.value || "").trim().toLowerCase();
      var sField = searchField ? searchField.value : "all";
      var field = sortField ? sortField.value : "created_at";
      var dir = sortDir ? sortDir.value : "desc";

      var filtered = allReservations.filter(function(r) {
        if (!term) return true;

        if (sField === "all") {
          var haystack = [
            String(r.id || ""),
            r.customer_name || "",
            r.customer_email || "",
            r.customer_phone || "",
            r.car_name || "",
            r.status || "",
            formatDateTime(r.created_at),
            formatDateTime(r.pickup_at),
            formatDateTime(r.dropoff_at)
          ].join(" ").toLowerCase();
          return haystack.indexOf(term) !== -1;
        }

        if (sField === "id") {
          return String(r.id || "").toLowerCase().indexOf(term) !== -1;
        }
        if (sField === "customer_name") {
          return (r.customer_name || "").toLowerCase().indexOf(term) !== -1;
        }
        if (sField === "customer_email") {
          return (r.customer_email || "").toLowerCase().indexOf(term) !== -1;
        }
        if (sField === "customer_phone") {
          var phoneNorm = normalizePhone(r.customer_phone);
          var termNorm = normalizePhone(term);
          if (!termNorm) return true;
          return phoneNorm.indexOf(termNorm) !== -1;
        }
        if (sField === "car_name") {
          return (r.car_name || "").toLowerCase().indexOf(term) !== -1;
        }
        if (sField === "status") {
          return (r.status || "").toLowerCase().indexOf(term) !== -1;
        }
        if (sField === "created_at" || sField === "pickup_at" || sField === "dropoff_at") {
          return formatDateTime(r[sField]).toLowerCase().indexOf(term) !== -1;
        }
        return true;
      });

      filtered.sort(function(a, b) {
        var av, bv;

        if (field === "id") {
          av = a.id;
          bv = b.id;
        } else if (field === "customer_name") {
          av = (a.customer_name || "").toLowerCase();
          bv = (b.customer_name || "").toLowerCase();
        } else if (field === "car_name") {
          av = (a.car_name || "").toLowerCase();
          bv = (b.car_name || "").toLowerCase();
        } else if (field === "status") {
          av = (a.status || "").toLowerCase();
          bv = (b.status || "").toLowerCase();
        } else {
          av = a[field] ? new Date(a[field]).getTime() : 0;
          bv = b[field] ? new Date(b[field]).getTime() : 0;
        }

        if (av < bv) return dir === "asc" ? -1 : 1;
        if (av > bv) return dir === "asc" ? 1 : -1;
        return 0;
      });

      currentReservations = filtered;
      renderReservationsTable(currentReservations);
    }

    // ======= RENDER STATISTICI =======
    function renderStats(reservations) {
      var total = reservations.length;
      var pending = reservations.filter(function (r) { return r.status === "pending"; }).length;
      var confirmed = reservations.filter(function (r) { return r.status === "confirmed"; }).length;
      var cancelled = reservations.filter(function (r) { return r.status === "cancelled"; }).length;

      document.getElementById("statTotal").textContent = total;
      document.getElementById("statPending").textContent = pending;
      document.getElementById("statConfirmed").textContent = confirmed;
      document.getElementById("statCancelled").textContent = cancelled;
    }

    // ======= RENDER TABEL REZERVƒÇRI =======
    function renderReservationsTable(reservations) {
      var tbody = document.getElementById("resRows");
      if (!tbody) return;
      tbody.innerHTML = "";

      reservations.forEach(function (r, idx) {
        var tr = document.createElement("tr");
        tr.className = (idx % 2 === 0 ? "bg-white" : "bg-slate-50/60") + " hover:bg-sky-50/90 transition-colors";

        var pickupText = formatDateTime(r.pickup_at) + (r.pickup_code ? " (" + r.pickup_code + ")" : "");
        var dropoffText = formatDateTime(r.dropoff_at) + (r.dropoff_code ? " (" + r.dropoff_code + ")" : "");
        var totalText = r.total_price != null ? (Number(r.total_price).toFixed(2) + " ‚Ç¨") : "-";
        var badgeClass = listStatusBadgeClass(r.status);

        tr.innerHTML =
          '<td class="py-3 pr-4 align-top text-xs font-mono text-slate-500">' + r.id + "</td>" +
          '<td class="py-3 pr-4 align-top">' +
            '<div class="text-sm font-medium text-slate-900">' + (r.customer_name || "-") + "</div>" +
            '<div class="text-xs text-slate-400">' + (r.customer_email || "") + "</div>" +
          "</td>" +
          '<td class="py-3 pr-4 align-top">' +
            '<div class="text-sm text-slate-900">' + (r.car_name || "-") + "</div>" +
          "</td>" +
          '<td class="py-3 pr-4 align-top">' +
            '<div class="text-xs text-slate-500">' + pickupText + "</div>" +
          "</td>" +
          '<td class="py-3 pr-4 align-top">' +
            '<div class="text-xs text-slate-500">' + dropoffText + "</div>" +
          "</td>" +
          '<td class="py-3 pr-4 align-top">' +
            '<div class="text-sm font-semibold text-slate-900">' + totalText + "</div>" +
          "</td>" +
          '<td class="py-3 pr-4 align-top">' +
            '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' +
              badgeClass + '">' +
              r.status +
            "</span>" +
          "</td>" +
          '<td class="py-3 pr-4 align-top">' +
            '<button class="px-2.5 py-1.5 rounded-full border border-slate-200 text-xs font-medium text-slate-700 hover:bg-slate-900 hover:text-white transition-colors" data-action="view" data-id="' + r.id + '">' +
              "Vezi detalii" +
            "</button>" +
          "</td>";

        tbody.appendChild(tr);
      });
    }

    // ======= MODAL DETALII =======
    function openReservationDetails(id) {
      var modal = document.getElementById("reservationModal");
      var body = document.getElementById("reservationModalBody");
      if (!modal || !body) return;

      var r = allReservations.find(function (x) { return x.id === id; });
      var docs = demoDocsByReservation[id] || [];
      var partners = demoPartners;

      if (!r) return;

      var pickupInfo = formatDateTime(r.pickup_at) +
        (r.pickup_name ? " ‚Äì " + r.pickup_name : "") +
        (r.pickup_code ? " (" + r.pickup_code + ")" : "");

      var dropoffInfo = formatDateTime(r.dropoff_at) +
        (r.dropoff_name ? " ‚Äì " + r.dropoff_name : "") +
        (r.dropoff_code ? " (" + r.dropoff_code + ")" : "");

      var docsHtml = "";
      if (docs.length) {
        docsHtml =
          '<ul class="list-disc pl-5 space-y-1 text-sm text-slate-100">' +
          docs.map(function (d) {
            var label = d.doc_type || d.file_name;
            return "<li>" + label + " (" + d.file_name + ")</li>";
          }).join("") +
          "</ul>";
      } else {
        docsHtml = '<div class="text-slate-500 text-sm">Nu existƒÉ documente ata»ôate.</div>';
      }

      var partnersOptions = partners.map(function (p) {
        return '<option value="' + p.id + '">' + p.name + "</option>";
      }).join("");

      var assignedPartner = null;
      if (r.partner_id) {
        assignedPartner = partners.find(function (p) { return p.id === r.partner_id; }) || null;
      }

      var partnerPill = "";
      if (assignedPartner) {
        partnerPill =
          '<div class="inline-flex items-center gap-2 rounded-full bg-emerald-500/10 text-emerald-300 px-3 py-1 text-xs font-medium ring-1 ring-emerald-500/40">' +
            '<span class="w-2 h-2 rounded-full bg-emerald-400"></span>' +
            '<span>Partener alocat: ' + assignedPartner.name + "</span>" +
          "</div>";
      } else {
        partnerPill =
          '<div class="inline-flex items-center gap-2 rounded-full bg-slate-800 text-slate-300 px-3 py-1 text-xs font-medium ring-1 ring-slate-600">' +
            '<span class="w-2 h-2 rounded-full bg-slate-500"></span>' +
            '<span>Partener nealocat</span>' +
          "</div>";
      }

      var idCombined = ((r.id_series || "") + (r.id_number ? " " + r.id_number : "")).trim();
      var licenseCombined = ((r.license_series || "") + (r.license_number ? " " + r.license_number : "")).trim();

      var actionsHtml = "";
      if (r.status !== "cancelled") {
        actionsHtml =
          '<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 pt-3 border-t border-slate-800">' +
            '<div class="flex flex-wrap gap-2">' +
              '<button id="btnEditReservation" class="px-3 py-1.5 rounded-full border border-slate-600 text-xs font-medium text-slate-100 hover:bg-slate-50 hover:text-slate-900 transition-colors">' +
                "ModificƒÉ rezervarea" +
              "</button>" +
              '<button id="btnExtendReservation" class="px-3 py-1.5 rounded-full border border-slate-600 text-xs font-medium text-slate-100 hover:bg-slate-50 hover:text-slate-900 transition-colors">' +
                "Prelunge»ôte returul" +
              "</button>" +
              '<button id="btnCancelReservation" class="px-3 py-1.5 rounded-full border border-rose-500/70 text-xs font-medium text-rose-200 bg-rose-500/10 hover:bg-rose-500 hover:text-white hover:border-rose-400 transition-colors">' +
                "AnuleazƒÉ rezervarea" +
              "</button>" +
            "</div>" +
            '<div class="flex flex-col sm:flex-row sm:items-center gap-2">' +
              '<select id="partnerSelect" class="border border-slate-700 bg-slate-900/60 text-slate-100 rounded-full px-3 py-1.5 text-xs min-w-[220px] focus:outline-none focus:ring-1 focus:ring-sky-500">' +
                '<option value="">Alege partener...</option>' +
                partnersOptions +
              "</select>" +
              '<button id="btnAssignPartner" class="px-3 py-1.5 rounded-full border border-sky-500 text-xs font-medium text-sky-100 bg-sky-600 hover:bg-sky-500 hover:border-sky-400 transition-colors">' +
                "AlocƒÉ / schimbƒÉ partenerul" +
              "</button>" +
            "</div>" +
          "</div>";
      }

      document.getElementById("reservationModalBody").innerHTML =
        '<div class="space-y-6">' +

          '<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">' +
            '<div class="space-y-1">' +
              sectionLabel("Rezervare") +
              '<div class="flex items-center gap-3">' +
                '<div class="font-mono text-xs text-slate-400">ID #' + r.id + "</div>" +
                '<span class="inline-flex items-center px-3 py-0.5 rounded-full text-[0.7rem] font-medium ' +
                  statusBadgeClass(r.status) + '">' +
                  r.status +
                "</span>" +
              "</div>" +
              '<div class="text-[0.7rem] text-slate-400 mt-1">CreatƒÉ la ' + formatDateTime(r.created_at) + "</div>" +
            "</div>" +
            '<div class="flex items-center gap-2">' + partnerPill + "</div>" +
          "</div>" +

          '<div class="grid grid-cols-1 md:grid-cols-2 gap-5">' +
            '<div class="space-y-4 bg-slate-900/60 rounded-2xl border border-slate-800 p-4 shadow-inner shadow-slate-900/60">' +
              sectionLabel("Date client") +
              fieldRow("Nume client", r.customer_name) +
              fieldRow("Email", r.customer_email) +
              fieldRow("Telefon", r.customer_phone) +
              '<div class="grid grid-cols-2 gap-4 mt-2">' +
                fieldRow("Data na»ôterii", formatDateOnly(r.birth_date)) +
                fieldRow("CNP", r.cnp) +
              "</div>" +
              '<div class="mt-2">' +
                fieldRow("Adresa de domiciliu", r.address) +
              "</div>" +
              '<div class="grid grid-cols-2 gap-4 mt-2">' +
                fieldRow("»öara din care cƒÉlƒÉtore»ôte", r.travel_country) +
                fieldRow("NumƒÉr zbor", r.flight_number) +
              "</div>" +
            "</div>" +

            '<div class="space-y-4 bg-slate-900/60 rounded-2xl border border-slate-800 p-4 shadow-inner shadow-slate-900/60">' +
              sectionLabel("Documente identitate & permis") +
              fieldRow("Serie »ôi numƒÉr CI / Pa»ôaport", idCombined) +
              fieldRow("Serie »ôi numƒÉr permis", licenseCombined) +
              '<div class="mt-3 space-y-2">' +
                sectionLabel("Documente √ÆncƒÉrcate") +
                '<div class="mt-1">' + docsHtml + "</div>" +
              "</div>" +
            "</div>" +
          "</div>" +

          '<div class="grid grid-cols-1 md:grid-cols-2 gap-5">' +
            '<div class="space-y-3 bg-slate-900/40 rounded-2xl border border-slate-800 p-4">' +
              sectionLabel("Rezervare ma»ôinƒÉ") +
              fieldRow("Ma»ôinƒÉ", r.car_name) +
              fieldRow("Preluare", pickupInfo) +
              fieldRow("Returnare", dropoffInfo) +
            "</div>" +
            '<div class="space-y-3 bg-slate-900/40 rounded-2xl border border-slate-800 p-4">' +
              sectionLabel("Detalii financiare & observa»õii") +
              fieldRow("Total", r.total_price != null ? (Number(r.total_price).toFixed(2) + " ‚Ç¨") : "-") +
              '<div class="mt-2 space-y-1">' +
                sectionLabel("Observa»õii") +
                '<div class="mt-1 text-sm text-slate-100 whitespace-pre-line">' + (r.notes || "‚Äî") + "</div>" +
              "</div>" +
            "</div>" +
          "</div>" +

          actionsHtml +

        "</div>";

      var editBtn = document.getElementById("btnEditReservation");
      if (editBtn) {
        editBtn.onclick = function () {
          alert("Aici, √Æn versiunea finalƒÉ, vei putea modifica toate c√¢mpurile rezervƒÉrii »ôi trimite PATCH la backend.");
        };
      }

      var extendBtn = document.getElementById("btnExtendReservation");
      if (extendBtn) {
        extendBtn.onclick = function () {
          alert("Aici vei putea modifica data/ora/aeroportul de returnare »ôi recalcula pre»õul.");
        };
      }

      var cancelBtn = document.getElementById("btnCancelReservation");
      if (cancelBtn) {
        cancelBtn.onclick = function () {
          alert("Aici vei putea apela endpoint-ul de anulare a rezervƒÉrii »ôi actualiza statusul √Æn 'cancelled'.");
        };
      }

      var assignBtn = document.getElementById("btnAssignPartner");
      var partnerSelect = document.getElementById("partnerSelect");
      if (assignBtn && partnerSelect) {
        assignBtn.onclick = function () {
          var pid = partnerSelect.value;
          if (!pid) {
            alert("Te rugƒÉm sƒÉ alegi un partener.");
            return;
          }
          alert("Aici vei trimite rezervarea cƒÉtre partenerul cu ID " + pid + " prin backend.");
        };
      }

      modal.classList.remove("hidden");
    }

    function closeReservationModal() {
      var modal = document.getElementById("reservationModal");
      if (modal) modal.classList.add("hidden");
    }

    // ======= INIT =======
    function init() {
      renderStats(allReservations);
      applyFiltersAndSort();

      var tbody = document.getElementById("resRows");
      if (tbody) {
        tbody.addEventListener("click", function (e) {
          var btn = e.target.closest("button");
          if (!btn) return;
          var action = btn.getAttribute("data-action");
          var id = parseInt(btn.getAttribute("data-id"), 10);
          if (action === "view" && id) {
            openReservationDetails(id);
          }
        });
      }

      var closeBtn = document.getElementById("reservationModalClose");
      if (closeBtn) {
        closeBtn.addEventListener("click", closeReservationModal);
      }
      var modal = document.getElementById("reservationModal");
      if (modal) {
        modal.addEventListener("click", function (e) {
          if (e.target === modal) closeReservationModal();
        });
      }

      var searchInput = document.getElementById("searchInput");
      var searchField = document.getElementById("searchField");
      var sortField = document.getElementById("sortField");
      var sortDir = document.getElementById("sortDir");

      if (searchInput) {
        searchInput.addEventListener("input", function () {
          applyFiltersAndSort();
        });
      }
      if (searchField) {
        searchField.addEventListener("change", function () {
          applyFiltersAndSort();
        });
      }
      if (sortField) {
        sortField.addEventListener("change", function () {
          applyFiltersAndSort();
        });
      }
      if (sortDir) {
        sortDir.addEventListener("change", function () {
          applyFiltersAndSort();
        });
      }
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
